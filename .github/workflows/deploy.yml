name: Deploy ESP32 Site

on:
  push:
    branches: ["main"]

permissions:
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Check if index.html exists
        id: check_files
        run: |
          if [ -f "index.html" ]; then
            echo "index.html exists, skipping creation"
            echo "html_exists=true" >> $GITHUB_OUTPUT
          else
            echo "index.html does not exist, creating basic version"
            echo "html_exists=false" >> $GITHUB_OUTPUT
          fi

      - name: Create basic HTML if missing
        if: steps.check_files.outputs.html_exists == 'false'
        run: |
          echo '<!DOCTYPE html>' > index.html
          echo '<html>' >> index.html
          echo '<head><title>ESP32数据监控</title></head>' >> index.html
          echo '<body>' >> index.html
          echo '<h1>ESP32数据系统</h1>' >> index.html
          echo '<p>请创建完整的index.html文件</p>' >> index.html
          echo '</body>' >> index.html
          echo '</html>' >> index.html

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: .

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
